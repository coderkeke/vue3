import{t as e}from"./card-C67QZlfo.js";import{An as t,Hn as n,Nn as r,Wn as i,Xn as a,bn as o,hn as s,rr as c,yn as l}from"./index-IbQU_uUx.js";import{t as u}from"./analysis-Cha_teIo.js";import{t as d}from"./Chart-CCRlrDo2.js";var f=o({__name:`TimeStackBarChart`,props:{conditions:{}},setup(o){let f=o,p=a(!1),m=a(null),h=async()=>{p.value=!0;try{let e=(await u(`发现时间,隐患级别`,f.conditions)).data;if(e&&e.success){let t=new Set,n=new Set,r=new Map;e.stats.forEach(e=>{let i=String(e.发现时间),a=String(e.隐患级别),o=e.count;t.add(i),n.add(a),r.has(i)||r.set(i,new Map),r.get(i).set(a,o)});let i=Array.from(t).sort(),a=Array.from(n),o=[`重大隐患`,`较大隐患`],s=a.map(e=>{let t=o.some(t=>e.includes(t));return{name:e,type:`bar`,stack:t?`high`:`low`,xAxisIndex:t?0:1,yAxisIndex:t?0:1,emphasis:{focus:`series`},data:i.map(t=>r.get(t)?.get(e)||0)}});m.value={title:{text:`发现时间与隐患级别趋势`,left:`center`},tooltip:{trigger:`axis`,axisPointer:{type:`shadow`}},legend:{data:a,top:`bottom`},axisPointer:{link:[{xAxisIndex:`all`}]},grid:[{left:`60`,right:`20`,top:`10%`,height:`35%`},{left:`60`,right:`20`,top:`55%`,height:`35%`}],xAxis:[{type:`category`,data:i,gridIndex:0,axisLabel:{show:!1},axisTick:{show:!1}},{type:`category`,data:i,gridIndex:1,position:`bottom`,axisLabel:{rotate:45}}],yAxis:[{type:`value`,gridIndex:0,name:`重大/较大`,nameLocation:`end`,splitLine:{show:!0,lineStyle:{type:`dashed`}}},{type:`value`,gridIndex:1,name:`一般/较小`,nameLocation:`end`,splitLine:{show:!0,lineStyle:{type:`dashed`}}}],series:s}}}finally{p.value=!1}};return n(()=>f.conditions,h,{deep:!0}),t(h),(t,n)=>{let a=e;return r(),s(a,{bordered:!1,loading:p.value},{default:i(()=>[l(c(d),{options:m.value,height:`400px`},null,8,[`options`])]),_:1},8,[`loading`])}}});export{f as t};